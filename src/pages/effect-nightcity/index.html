{% extends 'base.html' %}

<title>City Night</title>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&display=swap');

    body {
        font-family: 'Oswald', sans-serif;
        background: #000;
        overflow: hidden;
    }

    .g-flex-center {
        flex-direction: column;
        gap: 32px;
    }

    h1 {
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }

    .container {
        overflow: hidden;
        border-radius: 16px;
        position: relative;
        display: grid;
        grid-template-columns: repeat(20, 1fr);
        grid-template-rows: repeat(20, 1fr);
        gap: 1px;
        box-shadow: 0 0 1000px 10px rgba(255, 255, 255, 0.2);

        &:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(20px);
        }
    }

    .pixel {
        position: relative;
        width: 15px;
        height: 15px;
        background: #000;
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
</style>

<template>
    <div id="root" class="g-flex-center">
        <div class="container">
        </div>
        <h1>Fri, 9:00 PM</h1>
    </div>
</template>

<script>
    const $container = document.querySelector('.container');

    const $pixel = document.createElement('div');
    $pixel.classList.add('pixel');
    $pixel.style.transform = 'translate3d(0, 0, 0)';

    const $pixels = Array.from({ length: 400 }, () => $pixel.cloneNode());

    $container.append(...$pixels);

    /*
    마우스 주변 픽셀에 불들어 오는 것
    $container.addEventListener('mouseenter', (e) => {
        const { clientX, clientY } = e;
 
        $pixels.filter(($pixel, i) => {
            const { offsetLeft, offsetTop } = $pixel;
 
            const centerX = clientX - offsetLeft;
            const centerY = clientY - offsetTop;
 
            const distance = Math.sqrt(centerX ** 2 + centerY ** 2);
 
            if (distance < 5) {
                $pixel.style.background = `hsl(${i / 100}turn, 100%, 50%)`;
 
                // setTimeout(() => {
                //     $pixel.style.background = '#333';
                // }, 1000);
            }
        });
    });
    */

    /*
    마우스 클릭시 픽셀이 찍히는 것, URL에 저장 후 공유 가능
    let data = atob(location.hash.slice(1)).split(',').map(i => parseInt(i));
 
    if (data.length) {
        data.forEach((i, j) => {
            setTimeout(() => {
                const $pixel = document.querySelector(`.pixel:nth-child(${i + 1})`);
                $pixel.style.background = `hsl(${i / 100}turn, 100%, 50%)`;
            }, 100 * j);
        });
    }
 
    $pixels.forEach(($pixel, i) => {
        $pixel.addEventListener('click', (e) => {
            $pixel.style.background = `hsl(${i / 100}turn, 100%, 50%)`;
            if (data.includes(i)) {
                $pixel.style.background = '#333';
                data = data.filter(j => j !== i);
            } else {
                data.push(i);
            }
 
            history.pushState(null, null, `#${btoa(data.join(','))}`);
        });
    });
    */

    $pixels.forEach(($pixel, i) => {
        const colorChangeRandomize = () => {
            setTimeout(() => {
                if (Math.random() > 0.1) {
                    $pixel.style.background = '#000';
                } else {
                    $pixel.style.background = `hsl(${i / 100}turn, 100%, 50%)`;
                }
                colorChangeRandomize();
            }, Math.random() * 3000);
        };

        colorChangeRandomize();
    });
</script>